#!/bin/sh
if [ -z "$3" ]
  then
    echo "Usage: $0 <image-chroot> <image> <mountpoint>"
    echo "        Example:"
    echo "          $0 ./image/chroot/ ./image/bullseye.img /mnt/mount-point"
    exit
fi
set -ex 

IMAGE_CHROOT=$1
IMAGE=$2
MOUNTPOINT=$3

mountpoint $MOUNTPOINT && sudo umount $MOUNTPOINT/
sudo mount -o loop $IMAGE $MOUNTPOINT
sudo rsync -avh $IMAGE_CHROOT $MOUNTPOINT --delete
sudo umount $MOUNTPOINT

