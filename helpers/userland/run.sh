#!/bin/bash
if [ -z "$2" ]
  then
    echo "Usage: $0 <kernel> <image>"
    echo "        Example:"
    echo "           $0 ./kernel/linux-6.1/ ./kernel/linux-6.4 ./image/bullseye.img"
    exit
fi
set -ex 

KERNEL=$1
IMAGE=$2
qemu-system-x86_64 -nographic \
  -kernel $KERNEL \
  -drive file=$IMAGE \
  -append "root=/dev/sda rw console=ttyS0 rootfstype=ext4 nokaslr" \
  -m 1024M -s -cpu qemu64,+smep,+smap -smp 1 \
  -net user,host=10.0.2.10,hostfwd=tcp:127.0.0.1:10337-:22 \
  -net nic,model=e1000 \
  -snapshot
